<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>LEGO Tetris AI vs Human</title>
<style>
body{
  margin:0;
  background:linear-gradient(135deg,#fce38a,#f38181);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:Arial;
}
#container{display:flex;gap:30px;}
.board{text-align:center;}
canvas{
  background:#cce3ff;
  border-radius:12px;
  border:5px solid white;
}
#winner{
  position:fixed;inset:0;
  background:rgba(0,0,0,0.8);
  color:white;
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  font-size:32px;
}
button{
  margin-top:20px;
  padding:12px 25px;
  font-size:20px;
  border:none;
  border-radius:20px;
  cursor:pointer;
}
</style>
</head>
<body>

<div id="container">
  <div class="board">
    <h2>ü§ñ AI</h2>
    <p>Ï†êÏàò: <span id="scoreAI">0</span></p>
    <canvas id="ai" width="300" height="600"></canvas>
  </div>

  <div class="board">
    <h2>üßë ÏÇ¨Îûå</h2>
    <p>Ï†êÏàò: <span id="scoreHuman">0</span></p>
    <canvas id="human" width="300" height="600"></canvas>
  </div>
</div>

<div id="winner">
  <div id="winnerText"></div>
  <button onclick="location.reload()">Îã§Ïãú ÌïòÍ∏∞</button>
</div>

<script>
const COLS=10, ROWS=20, BLOCK=30, WIN_SCORE=1000;
const COLORS=[null,"#ff6b6b","#4dabf7","#ffd43b","#69db7c","#b197fc"];
const SHAPES=[
 [[1,1,1,1]],
 [[2,0,0],[2,2,2]],
 [[0,3,3],[3,3,0]],
 [[4,4],[4,4]],
 [[0,5,0],[5,5,5]]
];

// ---------- Í≥µÌÜµ ----------
const rotate = m => m[0].map((_,i)=>m.map(r=>r[i]).reverse());
const clone = m => m.map(r=>[...r]);

function drawLego(ctx,x,y,color){
  const px=x*BLOCK, py=y*BLOCK;
  ctx.fillStyle=color;
  ctx.fillRect(px,py,BLOCK,BLOCK);

  ctx.fillStyle="rgba(255,255,255,0.35)";
  ctx.fillRect(px,py,BLOCK,BLOCK/4);
  ctx.fillStyle="rgba(0,0,0,0.2)";
  ctx.fillRect(px,py+BLOCK*0.75,BLOCK,BLOCK/4);

  ctx.beginPath();
  ctx.arc(px+BLOCK/2,py+BLOCK/2,BLOCK/6,0,Math.PI*2);
  ctx.fillStyle="rgba(255,255,255,0.4)";
  ctx.fill();
}

// ---------- Í≤åÏûÑ ÌÅ¥ÎûòÏä§ ----------
function Game(canvas, scoreEl, isAI){
  this.ctx=canvas.getContext("2d");
  this.scoreEl=scoreEl;
  this.isAI=isAI;
  this.arena=Array.from({length:ROWS},()=>Array(COLS).fill(0));
  this.player={pos:{x:3,y:0},matrix:null};
  this.score=0;
  this.drop=0;
  this.interval=isAI?80:500; // ‚òÖ AI Ìõ®Ïî¨ Îπ†Î¶Ñ
  this.newPiece();
}

Game.prototype.newPiece=function(){
  this.player.matrix=clone(SHAPES[Math.random()*SHAPES.length|0]);
  this.player.pos={x:3,y:0};

  if(this.isAI){
    const best = this.findBestMove();
    this.player.matrix = best.matrix;
    this.player.pos.x = best.x;
  }
};

Game.prototype.collide=function(mat=this.player.matrix,pos=this.player.pos){
  for(let y=0;y<mat.length;y++)
    for(let x=0;x<mat[y].length;x++)
      if(mat[y][x] && (this.arena[y+pos.y]?.[x+pos.x])!==0)
        return true;
  return false;
};

Game.prototype.merge=function(){
  this.player.matrix.forEach((r,y)=>r.forEach((v,x)=>{
    if(v) this.arena[y+this.player.pos.y][x+this.player.pos.x]=v;
  }));
};

Game.prototype.clear=function(){
  for(let y=ROWS-1;y>=0;y--){
    if(this.arena[y].every(v=>v)){
      this.arena.splice(y,1);
      this.arena.unshift(Array(COLS).fill(0));
      this.score+=100;
      this.scoreEl.textContent=this.score;
      if(this.score>=WIN_SCORE) endGame(this.isAI?"AI":"ÏÇ¨Îûå");
      y++;
    }
  }
};

// ---------- AI Í≥†ÏÜç ÏÑúÏπò ----------
Game.prototype.findBestMove=function(){
  let best={score:1e9,x:0,matrix:null};

  let mat=clone(this.player.matrix);
  for(let r=0;r<4;r++){
    for(let x=-2;x<COLS;x++){
      let pos={x,y:0};
      while(!this.collide(mat,pos)) pos.y++;
      pos.y--;
      if(pos.y<0) continue;

      let height = pos.y;
      if(height < best.score){
        best={score:height,x,matrix:clone(mat)};
      }
    }
    mat=rotate(mat);
  }
  return best;
};

Game.prototype.update=function(dt){
  this.drop+=dt;
  if(this.drop>this.interval){
    this.player.pos.y++;
    if(this.collide()){
      this.player.pos.y--;
      this.merge();
      this.clear();
      this.newPiece();
    }
    this.drop=0;
  }

  this.ctx.clearRect(0,0,300,600);
  this.arena.forEach((r,y)=>r.forEach((v,x)=>{
    if(v) drawLego(this.ctx,x,y,COLORS[v]);
  }));
  this.player.matrix.forEach((r,y)=>r.forEach((v,x)=>{
    if(v) drawLego(this.ctx,x+this.player.pos.x,y+this.player.pos.y,COLORS[v]);
  }));
};

// ---------- Ïã§Ìñâ ----------
const aiGame=new Game(ai,scoreAI,true);
const humanGame=new Game(human,scoreHuman,false);

let last=0;
function loop(t=0){
  const dt=t-last; last=t;
  aiGame.update(dt);
  humanGame.update(dt);
  requestAnimationFrame(loop);
}
loop();

// ---------- ÏÇ¨Îûå Ï°∞Ïûë ----------
document.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft") humanGame.player.pos.x--;
  if(e.key==="ArrowRight") humanGame.player.pos.x++;
  if(e.key==="ArrowDown") humanGame.player.pos.y++;
  if(e.key==="ArrowUp"){
    const old=clone(humanGame.player.matrix);
    humanGame.player.matrix=rotate(humanGame.player.matrix);
    if(humanGame.collide()) humanGame.player.matrix=old;
  }
  if(humanGame.collide()){
    if(e.key==="ArrowLeft") humanGame.player.pos.x++;
    if(e.key==="ArrowRight") humanGame.player.pos.x--;
    if(e.key==="ArrowDown") humanGame.player.pos.y--;
  }
});

// ---------- ÏäπÎ¶¨ ----------
function endGame(winner){
  document.getElementById("winner").style.display="flex";
  document.getElementById("winnerText").textContent=`üéâ ${winner} ÏäπÎ¶¨!`;
}
</script>

</body>
</html>

